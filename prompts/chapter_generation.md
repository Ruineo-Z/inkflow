# 通用章节生成提示词

本文档包含适用于所有主题的章节生成提示词，包括后续章节摘要生成和章节正文生成。

## 📍 技术实现位置
- **章节生成**: `app/services/chapter_generator.py` (第98-153行, 第155-186行)

---

## 1. 后续章节摘要生成提示词

### System Prompt
```
【重要约束】请务必使用标准简体中文输出，严禁使用繁体字。所有文字内容（包括标题、摘要、人名、地名、武功名称等）都必须符合现代简体中文书写规范。

你是一位专业的{武侠/科幻}小说章节策划专家。
请根据前续章节内容和用户的选择，为下一章制定合理的剧情摘要。
确保剧情逻辑连贯，选择的后果得到合理体现。
```

### User Prompt Template
```
请为下一章创建详细摘要。

世界观设定：
{world_setting}

主角信息：
{protagonist_info}

{history_text}

最近章节完整内容：
{recent_chapters_text}

用户选择的选项：
{selected_option}

要求：
1. 仔细分析用户的选择，合理推进剧情发展
2. 基于最近5章的完整内容，保持剧情逻辑连贯性
3. 确保选择的后果在新章节中得到充分体现
4. 创造符合选择后果的吸引人的章节标题
5. 编写200-300字的详细摘要，概括本章剧情发展
6. 设计这一章的主要情节走向和发展脉络
7. 列出3-5个关键事件，体现剧情推进
8. 设计2-3个新的冲突点，为下一章的选择做准备
```

---

## 2. 章节正文和选项生成提示词

### System Prompt
```
【重要约束】请务必使用标准简体中文输出，严禁使用繁体字。所有文字内容（包括标题、正文、对话、人名、地名、武功名称、选项文本等）都必须符合现代简体中文书写规范。

你是一位专业的{武侠/科幻}小说作家。
请根据章节摘要和背景信息，创作出精彩的章节正文，并设计三个不同走向的选择选项。
正文应该生动有趣，选项应该提供明显不同的剧情发展方向。
```

### User Prompt Template
```
请根据以下信息创作完整的章节内容。

章节摘要：
标题：{title}
概要：{summary}
关键事件：{key_events}
冲突点：{conflicts}

世界观背景：
{world_setting}

主角信息：
{protagonist_info}

要求：
1. 创作2000-3000字的精彩章节正文
2. 文笔生动，对话自然，情节紧凑
3. 体现摘要中的关键事件和冲突
4. 在章节结尾设计悬念，引出选择点
5. 创造三个选择选项，每个选项代表不同的发展方向：
   - 选项1：积极主动的选择
   - 选项2：谨慎保守的选择
   - 选项3：冒险或意外的选择
6. 每个选项都要有简短的影响提示

请用JSON格式返回，包含title、content、options字段。
```

---

## 🔄 章节生成流程

### 生成步骤
1. **上下文构建**: 收集最近5章完整内容和更早章节摘要
2. **摘要生成**: 基于用户选择生成新章节摘要
3. **正文创作**: 根据摘要创作完整章节内容
4. **选项设计**: 生成三个不同方向的用户选择

### 上下文设计逻辑
- **最近5章**: 提供完整内容（摘要+正文），确保AI充分理解近期剧情发展
- **更早章节**: 只提供摘要信息，节省prompt空间避免信息重复
- **避免重复**: 通过章节编号过滤，确保同一章节不会既出现在完整内容又出现在摘要中
- **渐进衰减**: 越近的章节信息越详细，越远的章节信息越简化

---

## 📝 选项设计策略

### 三种选项类型
1. **积极主动选择**
   - 主角采取直接行动
   - 推动剧情快速发展
   - 可能带来正面结果，也可能增加风险

2. **谨慎保守选择**
   - 主角采取稳妥策略
   - 降低风险但可能错失机会
   - 强调思考和观察

3. **冒险或意外选择**
   - 出人意料的发展方向
   - 可能带来意外收获或危险
   - 增加故事的不确定性和刺激感

### 选项设计原则
- **明显差异**: 三个选项应该导向明显不同的剧情发展
- **合理性**: 每个选项都应该符合当前情境和角色设定
- **后果可见**: 选项的影响应该在后续章节中得到体现
- **平衡性**: 避免某个选项明显优于其他选项

---

## 🎯 质量控制要点

### 内容质量
- **字数控制**: 摘要200-300字，正文2000-3000字
- **逻辑连贯**: 确保与前续章节的逻辑一致性
- **选择影响**: 用户选择的后果必须在新章节中体现
- **悬念设计**: 章节结尾要有足够的悬念引出选择

### 技术要求
- **JSON格式**: 正文生成必须返回规范的JSON格式
- **字段完整**: 包含title、content、options三个必要字段
- **编码规范**: 所有内容使用标准简体中文

### 错误处理
- **生成失败**: 提供清晰的错误信息和重试机制
- **格式错误**: 验证JSON格式的正确性
- **内容异常**: 检查生成内容的合理性和安全性

---

## 📋 优化建议

### 当前优势
- 清晰的生成流程和质量控制
- 合理的上下文管理策略
- 多样化的选项设计机制

### 可优化方向
1. **个性化适配**: 根据用户历史选择调整生成风格
2. **情感连续性**: 更好地保持角色情感状态的连贯性
3. **世界观一致性**: 加强对世界观细节的一致性检查
4. **选择影响追踪**: 建立更复杂的选择后果追踪机制
5. **动态调整**: 根据故事长度动态调整上下文策略