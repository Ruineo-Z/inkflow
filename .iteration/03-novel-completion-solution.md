# 问题3：小说完结状态标识

**状态**: 🟡 设计进行中 - 待后续讨论

**问题描述**: 需要实现一个机制来标识小说何时完结，让用户和系统都能识别一个故事已经结束。

---

## 用户初始提案

> 小说的章节总数控制在25左右,具体结尾由LLM自己决定,但是LLM决定当前章节是最后一个时,就在提示词中说明这是最后一个章节,也就是结尾,不得生成option,然后后端通过判断章节是否有option,如果没有,则认为是结束

**核心思路**:
- 章节总数: ~25章
- 结尾决策权: LLM自主决定
- 标识方式: 最后一章不生成options
- 判断逻辑: `len(chapter.options) == 0` → 小说完结

---

## 初步讨论的问题点

### 1. 章节数量控制策略
- **硬限制**: 强制25章封顶
- **软引导**: 建议25章,但允许弹性
- **动态调整**: 根据故事复杂度自适应

### 2. 完结标识的可靠性
- LLM是否需要显式声明"这是最后一章"
- 是否需要数据库字段 `is_completed` / `completion_status`
- 如何防止LLM意外不生成options导致误判

### 3. 用户体验考量
- 完结章节是否需要特殊UI展示
- 是否允许用户在完结后继续"续写番外"
- 如何处理未完成就"卡住"的小说

---

## 待讨论的技术方案要点

### 数据库设计
- `novels` 表是否需要新增字段:
  - `is_completed: Boolean`
  - `completed_at: DateTime`
  - `max_chapters: Integer`

### AI提示词设计
- 如何在prompt中引导LLM正确标识结尾
- 如何平衡"故事自然结束"与"强制25章"

### 后端逻辑
- 章节生成时如何检测完结信号
- 完结后是否禁止继续生成新章节

### 前端展示
- 完结标识的UI设计(例如: "全文完"标签)
- 完结小说的列表区分展示

---

## 遗留决策点

1. 章节数量控制采用哪种策略?
2. 是否需要显式的完结确认机制?
3. 完结后是否允许用户继续生成"续篇"?
4. 如何处理LLM未按预期标识结尾的异常情况?

---

**后续讨论时**: 基于上述问题点,使用ISSUE范式进一步展开技术方案设计