# Inkflow 前端页面设计方案

## 整体导航架构

```
用户认证流程
├── 登录页面
├── 注册页面
└── 认证成功后进入APP

APP主界面
├── 我的小说列表
├── 创建新小说
├── 用户个人中心
└── 小说阅读器
    ├── 章节列表
    ├── 章节阅读
    └── 章节生成
```

---

## 页面详细设计

### 0. 应用启动页 (SplashScreen) `/`

**功能定位**
- 应用启动检查
- 用户认证状态检测
- 自动跳转到合适页面

**页面布局**
```
┌─────────────────────────────────────┐
│                                     │
│                                     │
│            🤖                       │
│        AI互动小说                   │
│                                     │
│        ●●●  加载中...               │
│                                     │
│                                     │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 检查本地token是否存在
- 验证token有效性
- 已登录用户跳转到首页
- 未登录用户跳转到登录页

**跳转逻辑**
1. 检查localStorage中的access_token
2. 如果存在，验证token有效性（调用/auth/me）
3. 有效则跳转到首页，无效则清除token跳转到登录页
4. 不存在则直接跳转到登录页

---

### 1. 登录页 (LoginPage) `/login`

**功能定位**
- 用户身份认证
- 账号密码登录
- 跳转注册页面

**页面布局**
```
┌─────────────────────────────────────┐
│             🤖                      │
│        AI互动小说                   │
│       你的选择决定故事走向              │
├─────────────────────────────────────┤
│                                     │
│  登录到你的账户                      │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 📧 邮箱地址                     │ │
│  │ user@example.com                │ │
│  └─────────────────────────────────┘ │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 🔒 密码                         │ │
│  │ ••••••••                        │ │
│  └─────────────────────────────────┘ │
│                                     │
│        [登录] (主按钮)               │
│                                     │
│  还没有账户？ [立即注册]              │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 邮箱密码输入
- 表单验证
- 登录状态管理
- 跳转到注册页

**API调用**
```javascript
// 用户登录
POST /api/v1/auth/login
{
    "email": "user@example.com",
    "password": "password123"
}
// 返回: { access_token, refresh_token, token_type }
```

**交互逻辑**
1. 实时表单验证（邮箱格式、密码长度）
2. 登录成功后保存token到localStorage
3. 跳转到首页
4. 登录失败显示错误提示

**状态管理**
- email: 邮箱输入
- password: 密码输入
- isLoading: 登录中状态
- error: 错误信息

---

### 2. 注册页 (RegisterPage) `/register`

**功能定位**
- 新用户注册
- 账户信息收集
- 注册后自动登录

**页面布局**
```
┌─────────────────────────────────────┐
│  ← 返回登录    创建新账户             │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 👤 用户名                       │ │
│  │ 请输入用户名                    │ │
│  └─────────────────────────────────┘ │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 📧 邮箱地址                     │ │
│  │ user@example.com                │ │
│  └─────────────────────────────────┘ │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 🔒 密码                         │ │
│  │ ••••••••                        │ │
│  └─────────────────────────────────┘ │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 🔒 确认密码                     │ │
│  │ ••••••••                        │ │
│  └─────────────────────────────────┘ │
│                                     │
│        [创建账户] (主按钮)            │
│                                     │
│  已有账户？ [返回登录]                │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 用户信息输入（姓名、邮箱、密码）
- 密码确认验证
- 邮箱唯一性检查
- 注册成功后自动登录

**API调用**
```javascript
// 用户注册
POST /api/v1/auth/register
{
    "name": "张三",
    "email": "user@example.com",
    "password": "password123"
}
// 返回: { access_token, refresh_token, token_type }
```

**交互逻辑**
1. 实时表单验证
2. 密码强度检查
3. 确认密码匹配验证
4. 注册成功后保存token并跳转到首页

**状态管理**
- name: 用户名
- email: 邮箱
- password: 密码
- confirmPassword: 确认密码
- isLoading: 注册中状态
- error: 错误信息

---

### 3. 首页 (HomePage) `/home`

**功能定位**
- 应用入口和导航中心
- 快速访问核心功能
- 展示应用特色

**页面布局**
```
┌─────────────────────────────────────┐
│  👤 张三                  ⚙️ 设置    │
│        🤖 AI互动小说                 │
│       你的选择决定故事走向             │
├─────────────────────────────────────┤
│                                     │
│        [我的小说] (主按钮)             │
│                                     │
│        [创建新小说] (次按钮)           │
│                                     │
│        最近阅读 (可选显示)             │
│        ┌─────────────────────┐      │
│        │ 《武林秘史》第3章    │      │
│        │ 继续阅读 →          │      │
│        └─────────────────────┘      │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 显示用户信息（头像、昵称）
- 导航到小说列表
- 导航到创建小说
- 显示最近阅读进度（可选）
- 导航到个人设置
- PWA安装提示

**API调用**
```javascript
// 获取当前用户信息
GET /api/v1/auth/me
// 返回: { id, name, email }

// 获取用户最近阅读记录（可选）
GET /api/v1/novels
```

**交互逻辑**
1. 页面加载时检查是否有最近阅读
2. 点击按钮导航到对应页面
3. 支持手势滑动导航（移动端）

---

### 2. 小说列表页 (NovelListPage) `/novels`

**功能定位**
- 展示用户的所有小说
- 管理小说（删除、查看详情）
- 快速进入阅读

**页面布局**
```
┌─────────────────────────────────────┐
│  ← 返回    我的小说      + 新建      │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 《江湖风云录》          武侠    │ │
│  │ 第8章 | 更新于2天前             │ │
│  │ [继续阅读]  [删除]              │ │
│  └─────────────────────────────────┘ │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 《星际征途》            科幻    │ │
│  │ 第3章 | 更新于1周前             │ │
│  │ [继续阅读]  [删除]              │ │
│  └─────────────────────────────────┘ │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 暂无更多小说                    │ │
│  │ [创建你的第一部小说]            │ │
│  └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 显示小说列表（标题、类型、章节数、最后更新时间）
- 删除小说（带确认弹窗）
- 进入小说阅读
- 创建新小说

**API调用**
```javascript
// 获取用户小说列表
GET /api/v1/novels

// 删除小说
DELETE /api/v1/novels/{novel_id}
```

**交互逻辑**
1. 页面加载时获取小说列表
2. 支持下拉刷新
3. 删除时显示确认对话框
4. 空状态引导用户创建小说

**状态管理**
- novels: 小说列表数据
- loading: 加载状态
- error: 错误信息

---

### 3. 创建小说页 (CreateNovelPage) `/create`

**功能定位**
- AI生成小说基础设定
- 用户选择类型和要求
- 创建完成后进入阅读

**页面布局**
```
┌─────────────────────────────────────┐
│  ← 返回        创建新小说            │
├─────────────────────────────────────┤
│                                     │
│  小说类型                           │
│  ○ 武侠小说  ● 科幻小说             │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │ 额外要求（可选）                │ │
│  │                                 │ │
│  │ 例如：希望主角是女性，故事背景   │ │
│  │ 设定在未来世界...               │ │
│  │                                 │ │
│  │                                 │ │
│  └─────────────────────────────────┘ │
│                                     │
│           [开始创作]                │
│                                     │
│  AI正在为你构思精彩的故事...        │
│  ████████████░░ 75%                 │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 选择小说类型（武侠/科幻）
- 输入额外要求
- AI生成小说设定
- 显示生成进度
- 创建完成后跳转到阅读页面

**API调用**
```javascript
// 创建小说
POST /api/v1/novels
{
    "genre": "wuxia|scifi",
    "additional_requirements": "用户输入的要求"
}
```

**交互逻辑**
1. 表单验证（类型必选）
2. 提交后显示加载动画
3. 成功后跳转到新创建的小说阅读页
4. 失败时显示错误信息

**状态管理**
- genre: 选择的类型
- requirements: 额外要求
- isCreating: 创建中状态
- createdNovel: 创建成功的小说信息

---

### 4. 小说阅读器 (NovelReaderPage) `/novels/:id`

**功能定位**
- 小说的总览入口
- 章节导航和管理
- 继续阅读快捷入口

**页面布局**
```
┌─────────────────────────────────────┐
│  ← 返回   《江湖风云录》    ⚙️      │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────────┐ │
│  │  武侠 | 8章节 | 最后阅读第6章   │ │
│  │                                 │ │
│  │  背景：明朝末年，江湖动荡...    │ │
│  │  主角：李云飞，身怀绝技...      │ │
│  └─────────────────────────────────┘ │
│                                     │
│        [继续阅读] [从头开始]         │
│                                     │
│  章节列表                           │
│  ┌─────────────────────────────────┐ │
│  │ ✓ 第一章：初入江湖        已读  │ │
│  │   选择：加入正道门派            │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │ ✓ 第二章：师父的秘密      已读  │ │
│  │   选择：偷看秘籍              │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │ → 第三章：生成下一章            │ │
│  └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 显示小说基本信息
- 展示章节列表及用户选择
- 继续阅读/从头开始
- 生成新章节入口

**API调用**
```javascript
// 获取小说详情
GET /api/v1/novels/{novel_id}

// 获取章节列表（包含用户选择）
GET /api/v1/novels/{novel_id}/chapters
```

**交互逻辑**
1. 根据URL参数获取小说信息
2. 显示章节列表和用户历史选择
3. 继续阅读跳转到最新章节
4. 点击章节跳转到章节阅读页

**状态管理**
- novel: 小说基本信息
- chapters: 章节列表
- lastReadChapter: 最后阅读位置

---

### 5. 章节阅读页 (ChapterReadingPage) `/novels/:id/chapters/:chapterId`

**功能定位**
- 沉浸式阅读体验
- 章节选择和决策
- 流式生成新内容

**页面布局**
```
┌─────────────────────────────────────┐
│  ← 返回     第3章      ≡ 章节      │
├─────────────────────────────────────┤
│                                     │
│        第三章：夜探敌营              │
│        ═══════════                  │
│                                     │
│    月黑风高的夜晚，你潜入了          │
│ 敌人的营地。守卫森严，稍有不慎        │
│ 就会被发现。你看到营帐中灯火          │
│ 通明，隐约听到里面传来争执声...       │
│                                     │
│    就在这时，你发现了一条通往        │
│ 大营深处的小径。你必须做出选择：      │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │  A. 直接冲进大帐，速战速决      │ │
│  │     💪 风险高，但可能获得重要信息  │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │  B. 沿小径潜行，避免正面冲突    │ │
│  │     🤫 安全但可能错过机会        │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │  C. 先观察一阵，等待时机        │ │
│  │     👁️ 谨慎行事，收集更多信息    │ │
│  └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 显示章节标题和内容
- 提供用户选择选项
- 保存用户选择
- 生成下一章节

**API调用**
```javascript
// 获取章节详情
GET /api/v1/chapters/{chapter_id}

// 保存用户选择
POST /api/v1/chapters/{chapter_id}/choice
{
    "option_id": 123
}
```

**交互逻辑**
1. 加载章节内容
2. 用户选择选项后保存到后端
3. 显示选择确认
4. 提供生成下一章的入口

**状态管理**
- chapter: 当前章节内容
- selectedOption: 用户选择
- isSelecting: 选择处理中状态

---

### 6. 章节生成页 (ChapterGeneratingPage) `/novels/:id/generate`

**功能定位**
- 实时展示AI生成过程
- 流式显示生成内容
- 生成完成后进入阅读

**页面布局**
```
┌─────────────────────────────────────┐
│  ✨ AI正在为你创作精彩的下一章...    │
├─────────────────────────────────────┤
│                                     │
│  📝 正在构思章节大纲...              │
│  ████████░░░░░░ 60%                 │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │  第四章：意外的邂逅              │ │
│  │                                 │ │
│  │  你选择了沿小径潜行，小心翼翼地  │ │
│  │ 避开巡逻的士兵。突然，前方传来一  │ │
│  │ 个女子的呼救声...               │ │
│  │                                 │ │
│  │  [内容正在生成中...]            │ │
│  │  ▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░          │ │
│  │                                 │ │
│  └─────────────────────────────────┘ │
│                                     │
│         预计剩余时间：30秒            │
│                                     │
│       [取消生成] [后台生成]          │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- SSE流式接收生成进度
- 实时显示生成状态
- 逐步展示生成的内容
- 生成完成后跳转到新章节

**API调用**
```javascript
// SSE流式章节生成
EventSource: /api/v1/novels/{novel_id}/chapters/generate

// 监听事件类型：
// - status: 状态更新
// - summary: 章节摘要
// - content: 内容片段
// - complete: 生成完成
// - error: 生成错误
```

**交互逻辑**
1. 建立SSE连接
2. 根据事件类型更新UI
3. 显示实时生成进度
4. 完成后跳转到新章节阅读页
5. 错误时提供重试选项

**状态管理**
- generationStatus: 生成状态
- generatedContent: 已生成内容
- progress: 生成进度
- eventSource: SSE连接

---

### 7. 用户个人中心 (ProfilePage) `/profile`

**功能定位**
- 用户信息管理
- 账户设置
- 登出功能

**页面布局**
```
┌─────────────────────────────────────┐
│  ← 返回        个人中心              │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────────┐ │
│  │     👤                          │ │
│  │   张三                          │ │
│  │   user@example.com              │ │
│  └─────────────────────────────────┘ │
│                                     │
│  账户统计                           │
│  ┌─────────────────────────────────┐ │
│  │  📚 创建小说数量: 5部           │ │
│  │  📖 总阅读章节: 48章           │ │
│  │  🕐 注册时间: 2024-01-15        │ │
│  └─────────────────────────────────┘ │
│                                     │
│  设置选项                           │
│  ┌─────────────────────────────────┐ │
│  │  🔐 修改密码                    │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │  📱 应用设置                    │ │
│  └─────────────────────────────────┘ │
│  ┌─────────────────────────────────┐ │
│  │  ❓ 帮助与反馈                  │ │
│  └─────────────────────────────────┘ │
│                                     │
│           [退出登录]                │
│                                     │
└─────────────────────────────────────┘
```

**核心功能**
- 显示用户基本信息
- 显示使用统计
- 修改密码（可选）
- 退出登录

**API调用**
```javascript
// 获取当前用户信息
GET /api/v1/auth/me
// 返回: { id, name, email }

// 用户统计信息（可选扩展）
GET /api/v1/users/stats

// 退出登录
POST /api/v1/auth/logout
```

**交互逻辑**
1. 加载用户信息和统计数据
2. 退出登录清除本地token
3. 跳转到登录页

**状态管理**
- userInfo: 用户基本信息
- stats: 使用统计
- isLoading: 加载状态

---

## 全局UI组件规划

### 通用组件

1. **AppHeader** - 页面顶部导航
   - 返回按钮
   - 页面标题
   - 右侧操作按钮

2. **NovelCard** - 小说卡片
   - 小说信息展示
   - 操作按钮组

3. **ChapterCard** - 章节卡片
   - 章节信息
   - 阅读状态
   - 用户选择显示

4. **LoadingSpinner** - 加载动画
   - 标准加载样式
   - 自定义加载文案

5. **OptionSelector** - 选择选项
   - 选项列表展示
   - 选择状态管理

6. **StreamingText** - 流式文本
   - 打字机效果
   - 实时内容更新

### 页面导航流程

```
应用启动 → 检查认证状态
├── 未登录 → 登录页 ⇄ 注册页 → 登录成功 → 首页
└── 已登录 → 首页

首页 → 小说列表 → 小说详情 → 章节阅读 → 生成新章节
    ↘ 创建新小说 → 小说详情 → 章节阅读
    ↘ 个人中心 → 设置/退出登录

认证流程：
登录页 ⇄ 注册页
└── 认证成功 → 保存token → 跳转首页
```

### 响应式断点

- 移动端：< 768px（主要适配）
- 平板：768px - 1024px
- 桌面：> 1024px

### 关键交互原则

1. **触摸友好**：按钮最小44px点击区域
2. **手势支持**：滑动返回、下拉刷新
3. **即时反馈**：操作后立即显示状态变化
4. **错误处理**：友好的错误提示和重试机制
5. **离线支持**：缓存关键内容，支持离线阅读

---

## 技术实现要点

### 路由配置
```javascript
const routes = [
    // 认证相关路由
    { path: '/', component: SplashScreen },
    { path: '/login', component: LoginPage },
    { path: '/register', component: RegisterPage },

    // 主应用路由（需要认证）
    { path: '/home', component: HomePage, requiresAuth: true },
    { path: '/novels', component: NovelListPage, requiresAuth: true },
    { path: '/create', component: CreateNovelPage, requiresAuth: true },
    { path: '/novels/:id', component: NovelReaderPage, requiresAuth: true },
    { path: '/novels/:id/chapters/:chapterId', component: ChapterReadingPage, requiresAuth: true },
    { path: '/novels/:id/generate', component: ChapterGeneratingPage, requiresAuth: true },
    { path: '/profile', component: ProfilePage, requiresAuth: true },

    // 404 页面
    { path: '*', component: NotFoundPage }
];

// 路由守卫
const AuthGuard = ({ children }) => {
    const token = localStorage.getItem('access_token');

    if (!token) {
        return <Navigate to="/login" replace />;
    }

    return children;
};
```

### 状态管理策略
- **全局认证状态**：使用AuthContext管理用户登录状态
- **页面级状态**：使用useState管理组件状态
- **API数据**：使用自定义hooks封装

```javascript
// AuthContext 全局认证状态
const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
    const [user, setUser] = useState(null);
    const [isLoading, setIsLoading] = useState(true);

    // 检查认证状态
    useEffect(() => {
        const token = localStorage.getItem('access_token');
        if (token) {
            // 验证token有效性
            fetchUserProfile().then(setUser).catch(() => {
                localStorage.removeItem('access_token');
            });
        }
        setIsLoading(false);
    }, []);

    const login = async (credentials) => {
        const response = await fetch('/api/v1/auth/login', {
            method: 'POST',
            body: JSON.stringify(credentials)
        });
        const data = await response.json();

        localStorage.setItem('access_token', data.access_token);
        localStorage.setItem('refresh_token', data.refresh_token);

        const userInfo = await fetchUserProfile();
        setUser(userInfo);
        return userInfo;
    };

    const logout = () => {
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        setUser(null);
    };

    return (
        <AuthContext.Provider value={{ user, login, logout, isLoading }}>
            {children}
        </AuthContext.Provider>
    );
};
```

### 性能优化
- 路由懒加载
- 图片懒加载
- 虚拟滚动（长列表）
- Service Worker缓存

这个设计方案覆盖了所有核心功能，确保了良好的用户体验和开发效率。每个页面都有明确的职责和交互逻辑，符合现代移动应用的设计标准。